// Generated by HLC 4.2.1 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <util/Server_Hashlink.h>
extern String s$Yes;
#include <haxe/ds/List.h>
#include <sys/net/Socket.h>
#include <haxe/ds/StringMap.h>
#include <sys/net/Host.h>
#include <hl/types/ArrayDyn.h>
#include <haxe/Log.h>
#include <util/SocketInformation.h>
#include <haxe/ds/_List/ListNode.h>
#include <haxe/io/Input.h>
#include <util/Response.h>
#include <haxe/Exception.h>
#include <haxe/io/Error.h>
extern hl_type t$haxe_ds_List;
void haxe_ds_List_new(haxe__ds__List);
extern hl_type t$sys_net_Socket;
void sys_net_Socket_new(sys__net__Socket);
extern hl_type t$haxe_ds_StringMap;
void haxe_ds_StringMap_new(haxe__ds__StringMap);
extern hl_type t$sys_net_Host;
extern String s$localhost;
void sys_net_Host_new(sys__net__Host,String);
void sys_net_Socket_bind(sys__net__Socket,sys__net__Host,int);
void sys_net_Socket_setBlocking(sys__net__Socket,bool);
void sys_net_Socket_listen(sys__net__Socket,int);
sys__net__Socket sys_net_Socket_accept(sys__net__Socket);
extern haxe__$Log g$_haxe_Log;
extern String s$opening_;
vvirtual* sys_net_Socket_peer(sys__net__Socket);
String Std_string(vdynamic*);
String String___add__(String,String);
extern hl_type t$vrt_329ffa8;
extern String s$util_Server_HashLink_hx;
extern hl_type t$String;
extern hl_type t$_i32;
extern String s$util_Server_Hashlink;
extern String s$listen;
extern hl_type t$vrt_eaa6a3b;
extern String s$;
#include <hl/natives.h>
String String___alloc__(vbyte*,int);
extern hl_type t$util_SocketInformation;
void util_SocketInformation_new(util__SocketInformation);
void haxe_ds_StringMap_set(haxe__ds__StringMap,String,vdynamic*);
void haxe_ds_List_add(haxe__ds__List,vdynamic*);
String haxe_io_Input_readLine(haxe__io__Input);
vdynamic* haxe_ds_StringMap_get(haxe__ds__StringMap,String);
void util_Response_write(util__Response,String);
int String___compare(String,vdynamic*);
extern String s$BLANK_LINE;
extern String s$f6b61e2;
extern String s$81051bc;
void sys_net_Socket_write(sys__net__Socket,String);
void sys_net_Socket_close(sys__net__Socket);
bool haxe_ds_List_remove(haxe__ds__List,vdynamic*);
haxe__Exception haxe_Exception_caught(vdynamic*);
extern venum* g$haxe_io_Error_Blocked;
vdynamic* haxe_Exception_thrown(vdynamic*);

void util_Server_Hashlink_new(util__Server_Hashlink r0) {
	String r1;
	r1 = (String)s$Yes;
	r0->existsing = r1;
	return;
}

void util_Server_Hashlink_listen(util__Server_Hashlink r0) {
	util__SocketInformation r20;
	String r7, r13, r24;
	vvirtual *r14, *r15, *r17;
	haxe__ds__StringMap r4;
	venum *r29;
	bool r9;
	sys__net__Socket r3, r5, r10;
	haxe__$Log r12;
	util__Response r25;
	haxe__ds__List r1;
	vclosure *r11;
	haxe__Exception r27;
	haxe__io__Input r23;
	haxe__ds___List__ListNode r21, r22;
	int *r18;
	vdynamic *r16, *r26, *r28;
	sys__net__Host r6;
	vbyte *r19;
	int r8;
	hl_trap_ctx trap$0;
	r1 = (haxe__ds__List)hl_alloc_obj(&t$haxe_ds_List);
	haxe_ds_List_new(r1);
	r3 = (sys__net__Socket)hl_alloc_obj(&t$sys_net_Socket);
	sys_net_Socket_new(r3);
	r4 = (haxe__ds__StringMap)hl_alloc_obj(&t$haxe_ds_StringMap);
	haxe_ds_StringMap_new(r4);
	r6 = (sys__net__Host)hl_alloc_obj(&t$sys_net_Host);
	r7 = (String)s$localhost;
	sys_net_Host_new(r6,r7);
	r8 = 8000;
	sys_net_Socket_bind(r3,r6,r8);
	r9 = false;
	sys_net_Socket_setBlocking(r3,r9);
	r8 = 9999;
	sys_net_Socket_listen(r3,r8);
	label$e1c46cb_2_15:
	r9 = true;
	if( !r9 ) goto label$e1c46cb_2_139;
	if( r3 == NULL ) hl_null_access();
	r5 = sys_net_Socket_accept(r3);
	if( !r5 ) goto label$e1c46cb_2_61;
	r12 = (haxe__$Log)g$_haxe_Log;
	r11 = r12->trace;
	if( r11 == NULL ) hl_null_access();
	r7 = (String)s$opening_;
	if( r5 == NULL ) hl_null_access();
	r14 = sys_net_Socket_peer(r5);
	r13 = Std_string(((vdynamic*)r14));
	r7 = String___add__(r7,r13);
	r15 = hl_alloc_virtual(&t$vrt_329ffa8);
	r13 = (String)s$util_Server_HashLink_hx;
	if( hl_vfields(r15)[1] ) *(String*)(hl_vfields(r15)[1]) = (String)r13; else hl_dyn_setp(r15->value,37969014/*fileName*/,&t$String,r13);
	r8 = 30;
	if( hl_vfields(r15)[2] ) *(int*)(hl_vfields(r15)[2]) = (int)r8; else hl_dyn_seti(r15->value,371360620/*lineNumber*/,&t$_i32,r8);
	r13 = (String)s$util_Server_Hashlink;
	if( hl_vfields(r15)[0] ) *(String*)(hl_vfields(r15)[0]) = (String)r13; else hl_dyn_setp(r15->value,-63073762/*className*/,&t$String,r13);
	r13 = (String)s$listen;
	if( hl_vfields(r15)[3] ) *(String*)(hl_vfields(r15)[3]) = (String)r13; else hl_dyn_setp(r15->value,302979532/*methodName*/,&t$String,r13);
	r17 = hl_to_virtual(&t$vrt_eaa6a3b,(vdynamic*)r15);
	r11->hasValue ? ((void (*)(vdynamic*,vdynamic*,vvirtual*))r11->fun)((vdynamic*)r11->value,((vdynamic*)r7),r17) : ((void (*)(vdynamic*,vvirtual*))r11->fun)(((vdynamic*)r7),r17);
	r14 = sys_net_Socket_peer(r5);
	if( r14 == NULL ) hl_null_access();
	r6 = hl_vfields(r14)[0] ? (*(sys__net__Host*)(hl_vfields(r14)[0])) : (sys__net__Host)hl_dyn_getp(r14->value,85119090/*host*/,&t$sys_net_Host);
	r7 = Std_string(((vdynamic*)r6));
	r13 = (String)s$;
	r7 = String___add__(r7,r13);
	r14 = sys_net_Socket_peer(r5);
	if( r14 == NULL ) hl_null_access();
	r8 = hl_vfields(r14)[1] ? (*(int*)(hl_vfields(r14)[1])) : (int)hl_dyn_geti(r14->value,173835403/*port*/,&t$_i32);
	r18 = &r8;
	r19 = hl_itos(r8,r18);
	r13 = String___alloc__(r19,r8);
	r7 = String___add__(r7,r13);
	r20 = (util__SocketInformation)hl_alloc_obj(&t$util_SocketInformation);
	util_SocketInformation_new(r20);
	if( r4 == NULL ) hl_null_access();
	haxe_ds_StringMap_set(r4,r7,((vdynamic*)r20));
	r9 = false;
	sys_net_Socket_setBlocking(r5,r9);
	if( r1 == NULL ) hl_null_access();
	haxe_ds_List_add(r1,((vdynamic*)r5));
	label$e1c46cb_2_61:
	if( r1 == NULL ) hl_null_access();
	r21 = r1->h;
	label$e1c46cb_2_63:
	if( !r21 ) goto label$e1c46cb_2_138;
	if( r21 == NULL ) hl_null_access();
	r16 = r21->item;
	r10 = (sys__net__Socket)r16;
	r22 = r21->next;
	r21 = r22;
	hl_trap(trap$0,r16,label$e1c46cb_2_129);
	if( r10 == NULL ) hl_null_access();
	r23 = r10->input;
	if( r23 == NULL ) hl_null_access();
	r7 = haxe_io_Input_readLine(r23);
	if( r4 == NULL ) hl_null_access();
	r14 = sys_net_Socket_peer(r10);
	if( r14 == NULL ) hl_null_access();
	r6 = hl_vfields(r14)[0] ? (*(sys__net__Host*)(hl_vfields(r14)[0])) : (sys__net__Host)hl_dyn_getp(r14->value,85119090/*host*/,&t$sys_net_Host);
	r13 = Std_string(((vdynamic*)r6));
	r24 = (String)s$;
	r13 = String___add__(r13,r24);
	r14 = sys_net_Socket_peer(r10);
	if( r14 == NULL ) hl_null_access();
	r8 = hl_vfields(r14)[1] ? (*(int*)(hl_vfields(r14)[1])) : (int)hl_dyn_geti(r14->value,173835403/*port*/,&t$_i32);
	r18 = &r8;
	r19 = hl_itos(r8,r18);
	r24 = String___alloc__(r19,r8);
	r13 = String___add__(r13,r24);
	r16 = haxe_ds_StringMap_get(r4,r13);
	r20 = (util__SocketInformation)r16;
	if( !r7 ) goto label$e1c46cb_2_96;
	if( r20 == NULL ) hl_null_access();
	r25 = r20->Response;
	if( r25 == NULL ) hl_null_access();
	util_Response_write(r25,r7);
	label$e1c46cb_2_96:
	r24 = (String)s$;
	if( r7 != r24 && (!r7 || !r24 || String___compare(r7,(vdynamic*)r24) != 0) ) goto label$e1c46cb_2_127;
	r12 = (haxe__$Log)g$_haxe_Log;
	r11 = r12->trace;
	if( r11 == NULL ) hl_null_access();
	r13 = (String)s$BLANK_LINE;
	r15 = hl_alloc_virtual(&t$vrt_329ffa8);
	r24 = (String)s$util_Server_HashLink_hx;
	if( hl_vfields(r15)[1] ) *(String*)(hl_vfields(r15)[1]) = (String)r24; else hl_dyn_setp(r15->value,37969014/*fileName*/,&t$String,r24);
	r8 = 51;
	if( hl_vfields(r15)[2] ) *(int*)(hl_vfields(r15)[2]) = (int)r8; else hl_dyn_seti(r15->value,371360620/*lineNumber*/,&t$_i32,r8);
	r24 = (String)s$util_Server_Hashlink;
	if( hl_vfields(r15)[0] ) *(String*)(hl_vfields(r15)[0]) = (String)r24; else hl_dyn_setp(r15->value,-63073762/*className*/,&t$String,r24);
	r24 = (String)s$listen;
	if( hl_vfields(r15)[3] ) *(String*)(hl_vfields(r15)[3]) = (String)r24; else hl_dyn_setp(r15->value,302979532/*methodName*/,&t$String,r24);
	r17 = hl_to_virtual(&t$vrt_eaa6a3b,(vdynamic*)r15);
	r11->hasValue ? ((void (*)(vdynamic*,vdynamic*,vvirtual*))r11->fun)((vdynamic*)r11->value,((vdynamic*)r13),r17) : ((void (*)(vdynamic*,vvirtual*))r11->fun)(((vdynamic*)r13),r17);
	r13 = (String)s$f6b61e2;
	if( r20 == NULL ) hl_null_access();
	r25 = r20->Response;
	if( r25 == NULL ) hl_null_access();
	r24 = r25->_Content;
	r13 = String___add__(r13,r24);
	r24 = (String)s$81051bc;
	r13 = String___add__(r13,r24);
	sys_net_Socket_write(r10,r13);
	sys_net_Socket_close(r10);
	r9 = true;
	r20->Killable = r9;
	if( r1 == NULL ) hl_null_access();
	r9 = haxe_ds_List_remove(r1,((vdynamic*)r10));
	label$e1c46cb_2_127:
	hl_endtrap(trap$0);
	goto label$e1c46cb_2_137;
	label$e1c46cb_2_129:
	r26 = NULL;
	r27 = haxe_Exception_caught(r16);
	if( r27 == NULL ) hl_null_access();
	r26 = ((vdynamic* (*)(haxe__Exception))r27->$type->vobj_proto[0])(r27);
	r29 = (venum*)g$haxe_io_Error_Blocked;
	{ int i = hl_dyn_compare((vdynamic*)r26,(vdynamic*)r29); if( i == 0 ) goto label$e1c46cb_2_137; };
	r28 = haxe_Exception_thrown(r26);
	hl_throw((vdynamic*)r28);
	label$e1c46cb_2_137:
	goto label$e1c46cb_2_63;
	label$e1c46cb_2_138:
	goto label$e1c46cb_2_15;
	label$e1c46cb_2_139:
	return;
}

