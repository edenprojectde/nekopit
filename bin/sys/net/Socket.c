// Generated by HLC 4.2.1 (HL v4)
#define HLC_BOOT
#include <hlc.h>
#include <sys/net/Socket.h>
void sys_net_Socket_init(sys__net__Socket);
#include <hl/natives.h>
#include <sys/net/_Socket/SocketInput.h>
#include <sys/net/_Socket/SocketOutput.h>
extern hl_type t$sys_net__Socket_SocketInput;
void sys_net__Socket_SocketInput_new(sys__net___Socket__SocketInput,sys__net__Socket);
extern hl_type t$sys_net__Socket_SocketOutput;
void sys_net__Socket_SocketOutput_new(sys__net___Socket__SocketOutput,sys__net__Socket);
#include <haxe/io/Encoding.h>
void haxe_io_Output_writeString(haxe__io__Output,String,venum*);
#include <_std/SysError.h>
extern hl_type t$SysError;
extern String s$listen_failure;
void SysError_new(SysError,String);
vdynamic* haxe_Exception_thrown(vdynamic*);
#include <sys/net/Host.h>
extern String s$Cannot_bind_socket_on_;
String Std_string(vdynamic*);
String String___add__(String,String);
extern String s$853ae90;
String String___alloc__(vbyte*,int);
extern hl_type t$sys_net_Socket;
extern hl_type t$sys_net_Host;
extern hl_type t$vrt_5f22fa8;
extern hl_type t$_i32;
extern String s$setBlocking_failure;

void sys_net_Socket_new(sys__net__Socket r0) {
	sys_net_Socket_init(r0);
	return;
}

void sys_net_Socket_init(sys__net__Socket r0) {
	sys__net___Socket__SocketInput r4;
	bool r3;
	hl_socket *r2;
	sys__net___Socket__SocketOutput r5;
	r2 = r0->__s;
	if( r2 ) goto label$f766754_2_5;
	r3 = false;
	r2 = hl_socket_new(r3);
	r0->__s = r2;
	label$f766754_2_5:
	r4 = (sys__net___Socket__SocketInput)hl_alloc_obj(&t$sys_net__Socket_SocketInput);
	sys_net__Socket_SocketInput_new(r4,r0);
	r0->input = ((haxe__io__Input)r4);
	r5 = (sys__net___Socket__SocketOutput)hl_alloc_obj(&t$sys_net__Socket_SocketOutput);
	sys_net__Socket_SocketOutput_new(r5,r0);
	r0->output = ((haxe__io__Output)r5);
	return;
}

void sys_net_Socket_close(sys__net__Socket r0) {
	hl_socket *r2;
	r2 = r0->__s;
	if( !r2 ) goto label$f766754_3_6;
	r2 = r0->__s;
	hl_socket_close(r2);
	r2 = NULL;
	r0->__s = r2;
	label$f766754_3_6:
	return;
}

void sys_net_Socket_write(sys__net__Socket r0,String r1) {
	venum *r4;
	haxe__io__Output r3;
	r3 = r0->output;
	if( r3 == NULL ) hl_null_access();
	r4 = NULL;
	haxe_io_Output_writeString(r3,r1,r4);
	return;
}

void sys_net_Socket_listen(sys__net__Socket r0,int r1) {
	String r7;
	SysError r6;
	bool r3;
	hl_socket *r4;
	vdynamic *r5;
	r4 = r0->__s;
	r3 = hl_socket_listen(r4,r1);
	if( r3 ) goto label$f766754_5_8;
	r6 = (SysError)hl_alloc_obj(&t$SysError);
	r7 = (String)s$listen_failure;
	SysError_new(r6,r7);
	r5 = haxe_Exception_thrown(((vdynamic*)r6));
	hl_throw((vdynamic*)r5);
	label$f766754_5_8:
	return;
}

void sys_net_Socket_bind(sys__net__Socket r0,sys__net__Host r1,int r2) {
	String r9, r10;
	SysError r8;
	bool r4;
	hl_socket *r5;
	int *r11;
	vdynamic *r7;
	vbyte *r12;
	int r6;
	r5 = r0->__s;
	if( r1 == NULL ) hl_null_access();
	r6 = r1->ip;
	r4 = hl_socket_bind(r5,r6,r2);
	if( r4 ) goto label$f766754_6_19;
	r8 = (SysError)hl_alloc_obj(&t$SysError);
	r9 = (String)s$Cannot_bind_socket_on_;
	r10 = Std_string(((vdynamic*)r1));
	r9 = String___add__(r9,r10);
	r10 = (String)s$853ae90;
	r9 = String___add__(r9,r10);
	r6 = r2;
	r11 = &r6;
	r12 = hl_itos(r6,r11);
	r10 = String___alloc__(r12,r6);
	r9 = String___add__(r9,r10);
	SysError_new(r8,r9);
	r7 = haxe_Exception_thrown(((vdynamic*)r8));
	hl_throw((vdynamic*)r7);
	label$f766754_6_19:
	return;
}

sys__net__Socket sys_net_Socket_accept(sys__net__Socket r0) {
	sys__net___Socket__SocketInput r4;
	sys__net__Socket r3;
	hl_socket *r1;
	sys__net___Socket__SocketOutput r5;
	r1 = r0->__s;
	r1 = hl_socket_accept(r1);
	if( r1 ) goto label$f766754_7_5;
	r3 = NULL;
	return r3;
	label$f766754_7_5:
	r3 = (sys__net__Socket)hl_alloc_obj(&t$sys_net_Socket);
	r3->__s = r1;
	r4 = (sys__net___Socket__SocketInput)hl_alloc_obj(&t$sys_net__Socket_SocketInput);
	sys_net__Socket_SocketInput_new(r4,r3);
	r3->input = ((haxe__io__Input)r4);
	r5 = (sys__net___Socket__SocketOutput)hl_alloc_obj(&t$sys_net__Socket_SocketOutput);
	sys_net__Socket_SocketOutput_new(r5,r3);
	r3->output = ((haxe__io__Output)r5);
	return r3;
}

vvirtual* sys_net_Socket_peer(sys__net__Socket r0) {
	vvirtual *r7;
	bool r6;
	hl_socket *r3;
	sys__net__Host r8;
	int *r4, *r5;
	int r1, r2;
	r1 = 0;
	r2 = 0;
	r3 = r0->__s;
	r4 = &r1;
	r5 = &r2;
	r6 = hl_socket_peer(r3,r4,r5);
	if( r6 ) goto label$f766754_8_9;
	r7 = NULL;
	return r7;
	label$f766754_8_9:
	r8 = (sys__net__Host)hl_alloc_obj(&t$sys_net_Host);
	r8->ip = r1;
	r7 = hl_alloc_virtual(&t$vrt_5f22fa8);
	if( hl_vfields(r7)[0] ) *(sys__net__Host*)(hl_vfields(r7)[0]) = (sys__net__Host)r8; else hl_dyn_setp(r7->value,85119090/*host*/,&t$sys_net_Host,r8);
	if( hl_vfields(r7)[1] ) *(int*)(hl_vfields(r7)[1]) = (int)r2; else hl_dyn_seti(r7->value,173835403/*port*/,&t$_i32,r2);
	return r7;
}

void sys_net_Socket_setBlocking(sys__net__Socket r0,bool r1) {
	String r7;
	SysError r6;
	bool r3;
	hl_socket *r4;
	vdynamic *r5;
	r4 = r0->__s;
	r3 = hl_socket_set_blocking(r4,r1);
	if( r3 ) goto label$f766754_9_8;
	r6 = (SysError)hl_alloc_obj(&t$SysError);
	r7 = (String)s$setBlocking_failure;
	SysError_new(r6,r7);
	r5 = haxe_Exception_thrown(((vdynamic*)r6));
	hl_throw((vdynamic*)r5);
	label$f766754_9_8:
	return;
}

